<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products - SuppliFy</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/static/css/styles.css">
  <link rel="stylesheet" href="/static/css/animations.css">
  <link rel="stylesheet" href="/static/css/products.css">
  <link rel="stylesheet" href="/static/css/buyerdashboard.css">
  <style>

    .filter-options {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
    align-items: center;
    background-color: var(--white);
    padding: 1rem 1.5rem;
    border-radius: var(--rounded-lg);
    box-shadow: var(--shadow-sm);
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group label {
    font-weight: 500;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.filter-select {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--rounded);
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-light);
    transition: all 0.3s ease;
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

#apply-filters {
    margin-left: auto;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 3rem;
}

.pagination a {
    padding: 0.5rem 1rem;
    border-radius: var(--rounded);
    color: var(--text-medium);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.pagination a:hover {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
}

.pagination a.active {
    background-color: var(--primary-color);
    color: var(--white);
}

/* Responsive Design */
@media (max-width: 768px) {
    .filter-options {
        flex-direction: column;
        align-items: flex-start;
    }

    #apply-filters {
        margin-left: 0;
        width: 100%;
    }

    .filter-group {
        width: 100%;
    }

    .filter-select {
        flex: 1;
    }
}

@media (max-width: 480px) {
    .pagination a {
        padding: 0.5rem;
        font-size: 0.85rem;
    }
}

/* Improved Reviews Section */
  .reviews-section {
    background: #fffcf5;
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 2px 12px rgba(100, 80, 50, 0.08);
    border: 1px solid #f5e9d0;
  }

  .reviews-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f0e6d2;
  }

  .reviews-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    color: #8a5a00;
  }

  .reviews-title i {
    font-size: 1.2rem;
    color: #f59e0b;
  }

  .reviews-summary {
    font-size: 0.95rem;
    color: #8a5a00;
    font-weight: 500;
  }

  .reviews-list {
    max-height: 200px;
    overflow-y: auto;
    padding-right: 8px;
    scrollbar-width: thin;
    scrollbar-color: #f0e6d2 transparent;
  }

  .reviews-list::-webkit-scrollbar {
    width: 6px;
  }

  .reviews-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .reviews-list::-webkit-scrollbar-thumb {
    background-color: #f0e6d2;
    border-radius: 6px;
  }

  .review-item {
    padding: 16px 0;
    border-bottom: 1px solid #f5f0e4;
  }

  .review-item:last-child {
    border-bottom: none;
    padding-bottom: 8px;
  }

  .review-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 8px;
    flex-wrap: wrap;
    gap: 8px;
  }

  .reviewer-info {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .reviewer-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #f5e9d0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #8a5a00;
    font-weight: 600;
    font-size: 0.85rem;
  }

  .reviewer-name {
    font-weight: 600;
    color: #5a4a30;
    font-size: 0.95rem;
    display: flex;
    flex-direction: column;
  }

  .reviewer-name span {
    font-weight: 400;
    font-size: 0.85rem;
    color: #8a7c6a;
  }

  .review-date {
    font-size: 0.85rem;
    color: #8a7c6a;
    margin-left: auto;
    white-space: nowrap;
  }

  .review-stars {
    display: flex;
    gap: 2px;
    margin-left: 8px;
  }

  .review-stars i {
    font-size: 0.9rem;
    color: #f59e0b;
  }

  .review-body {
    margin-left: 40px;
    margin-top: 8px;
    font-size: 0.95rem;
    color: #5a4a30;
    line-height: 1.5;
    padding-right: 8px;
  }

  .reviews-empty {
    text-align: center;
    padding: 20px 0;
    color: #8a7c6a;
    font-style: italic;
    font-size: 0.95rem;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .reviews-section {
      padding: 16px;
    }

    .review-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }

    .review-date {
      margin-left: 0;
      margin-top: 4px;
    }

    .review-body {
      margin-left: 0;
      padding-left: 40px;
    }
  }
  </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar">
  <div class="navbar-container">
    <a href="#" class="navbar-brand">SuppliFy</a>
    <div class="navbar-toggle" id="mobile-menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </div>
    <ul class="navbar-nav">
      <li><a href="/buyerdashboard" class="nav-link"><i class="fas fa-home"></i> Home</a></li>
      <li><a th:href="@{/products_for_buy}" class="nav-link active"><i class="fas fa-box-open"></i> Products</a></li>
      <li><a th:href="@{/orders/history}" class="nav-link"><i class="fas fa-shopping-bag"></i> Orders</a></li>
      <li><a th:href="@{/profile}" class="nav-link"><i class="fas fa-user"></i> Profile</a></li>
      <li><a th:href="@{/logout}" class="nav-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>

  </div>
</nav>

<div class="main-content">
  <div class="products-section slide-in-bottom">
    <h2 class="section-title">
      <span class="title-icon"><i class="fas fa-boxes"></i></span>
      Available Products
    </h2>

    <!-- Search Form -->
    <form th:action="@{/products_for_buy/search}" method="get" class="search-form fade-in">
      <input type="text" name="keyword" th:value="${keyword}" placeholder="Search products..." class="search-input">
      <button type="submit" class="search-btn btn-hover">
        <i class="fas fa-search"></i> Search
      </button>
    </form>

    <!-- Filter Options -->
    <div class="filter-options fade-in">
      <div class="filter-group">
        <label for="category"><i class="fas fa-tags"></i> Category:</label>
        <select id="category" class="filter-select">
          <option value="all">All Categories</option>
          <option th:each="category : ${categories}"
                  th:value="${category.id}"
                  th:text="${category.name}">
            Category
          </option>
        </select>
      </div>
      <div class="filter-group">
        <label for="sort"><i class="fas fa-sort"></i> Sort By:</label>
        <select id="sort" class="filter-select">
          <option value="popular">Most Popular</option>
          <option value="newest">Newest</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
        </select>
      </div>
      <button class="btn btn-secondary btn-hover" id="apply-filters">
        <i class="fas fa-filter"></i> Apply Filters
      </button>
    </div>

    <div class="products-grid">
      <div th:each="product : ${products}" class="product-item fade-in" th:id="${product.id}">
        <div class="product-image-container">
          <img th:src="${product.imageUrls[0]}" alt="Product Image" class="product-image">
          <div class="discount-badge pulse" th:if="${product.discountPercentage > 0}">
            -<span th:text="${product.discountPercentage}">0</span>%
          </div>
        </div>
        <div class="product-details">

          <h3 class="product-name" th:text="${product.name}">Product Name</h3>
          <p class="product-description" th:text="${product.description}">Product Description</p>
          <div class="product-pricing">
            <span class="original-price" th:if="${product.discountPercentage > 0}" th:text="'$' + ${product.price}">$0.00</span>
            <span class="discounted-price" th:text="'$' + ${product.discountedPrice}">$0.00</span>
          </div>
          <div class="product-stock">
            <i class="fas fa-cubes"></i> <span th:text="${product.quantity} + ' left in stock'">0 left in stock</span>
          </div>
        </div>
        <div class="product-actions">
          <button class="btn btn-buy btn-hover" th:onclick="|window.location.href='/checkout/${product.id}';|">
            <i class="fas fa-shopping-cart"></i> Buy Now
          </button>
          <button class="btn btn-message btn-hover"
                  th:onclick="'window.location.href=\'/messages/open/' + ${product.id} + '\';'">
            <i class="fas fa-envelope"></i> Message
          </button>
        </div>


        <!-- Reviews Section -->
        <div class="reviews-section fade-in">
          <div class="reviews-header">
            <div class="reviews-title">
              <i class="fas fa-star"></i>
              <span>Customer Reviews</span>
            </div>
            <div class="reviews-summary"
                 th:if="${product.averageRating != null and product.ratingCount > 0}"
                 th:text="|${#numbers.formatDecimal(product.averageRating, 1, 1)} · ${product.ratingCount} reviews|">
              4.8 · 12 reviews
            </div>
            <div class="reviews-summary"
                 th:unless="${product.averageRating != null && product.ratingCount > 0}">
              No ratings yet
            </div>
          </div>

          <div class="reviews-list"
               th:if="${productRatingsMap[product.id] != null and #lists.size(productRatingsMap[product.id]) > 0}">
            <div class="review-item" th:each="rating : ${productRatingsMap[product.id]}">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar"
                       th:text="${rating.buyer.firstName.substring(0,1) + rating.buyer.lastName.substring(0,1)}">
                    JD
                  </div>
                  <div class="reviewer-name">
                    <span th:text="${rating.buyer.firstName + ' ' + rating.buyer.lastName}">John Doe</span>
                    <span class="review-date"
                          th:text="|${T(java.time.format.DateTimeFormatter).ofPattern('MMM dd, yyyy').format(rating.createdAt)}|">
              Jun 15, 2023
            </span>
                  </div>
                </div>

                <div class="review-stars">
          <span th:each="i : ${#numbers.sequence(1, 5)}">
            <i th:class="${i <= rating.ratingValue} ? 'fas fa-star' : 'far fa-star'"></i>
          </span>
                </div>
              </div>

              <div class="review-body"
                   th:if="${rating.review != null && rating.review != ''}"
                   th:text="${rating.review}">
                Great product! Exactly as described and arrived quickly. Very happy with my purchase.
              </div>
              <div class="review-body"
                   th:unless="${rating.review != null && rating.review != ''}"
                   style="font-style: italic; color: #8a7c6a;">
                No review provided.
              </div>
            </div>
          </div>

          <div class="reviews-empty"
               th:if="${productRatingsMap[product.id] == null or #lists.size(productRatingsMap[product.id]) == 0}">
            <span>No reviews for this product yet.</span>
          </div>
        </div>

    </div>

    <!-- Pagination -->
    <div class="pagination fade-in" th:if="${totalPages > 1}">
      <a th:if="${currentPage > 1}" th:href="@{'/products_for_buy?page=' + ${currentPage - 1}}">
        <i class="fas fa-chevron-left"></i> Previous
      </a>
      <span th:each="page : ${#numbers.sequence(1, totalPages)}">
                <a th:if="${page == currentPage}" class="active" th:text="${page}">1</a>
                <a th:unless="${page == currentPage}" th:href="@{'/products_for_buy?page=' + ${page}}" th:text="${page}">1</a>
            </span>
      <a th:if="${currentPage < totalPages}" th:href="@{'/products_for_buy?page=' + ${currentPage + 1}}">
        Next <i class="fas fa-chevron-right"></i>
      </a>
    </div>
  </div>
</div>

<script src="/static/js/script.js"></script>
<script src="/static/js/products.js"></script>
</body>
</html>